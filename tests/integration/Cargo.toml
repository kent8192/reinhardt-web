[package]
name = "reinhardt-integration-tests"
version = "0.1.0"
edition = "2021"
publish = false
autotests = false

[workspace]

[dependencies]
# Reinhardt crates
reinhardt-contrib = { path = "../../crates/reinhardt-contrib" }
reinhardt-admin = { path = "../../crates/reinhardt-contrib/crates/admin" }
reinhardt-auth = { path = "../../crates/reinhardt-contrib/crates/auth" }
reinhardt-security = { path = "../../crates/reinhardt-core/crates/security" }
reinhardt-middleware = { path = "../../crates/reinhardt-middleware" }
reinhardt-templates = { path = "../../crates/reinhardt-template/crates/templates" }
reinhardt-apps = { path = "../../crates/reinhardt-apps" }
reinhardt-routers = { path = "../../crates/reinhardt-urls/crates/routers" }
reinhardt-viewsets = { path = "../../crates/reinhardt-views/crates/viewsets" }
reinhardt-openapi = { path = "../../crates/reinhardt-rest/crates/openapi" }
reinhardt-graphql = { path = "../../crates/reinhardt-contrib/crates/graphql" }
reinhardt-orm = { path = "../../crates/reinhardt-db/crates/orm", features = [
  "django-compat",
] }
reinhardt-migrations = { path = "../../crates/reinhardt-db/crates/migrations" }
backends = { path = "../../crates/reinhardt-db/crates/backends", package = "reinhardt-db-backends", features = [
  "postgres",
  "sqlite",
] }
reinhardt-metadata = { path = "../../crates/reinhardt-rest/crates/metadata" }
reinhardt-versioning = { path = "../../crates/reinhardt-rest/crates/versioning" }
reinhardt-messages = { path = "../../crates/reinhardt-contrib/crates/messages" }
reinhardt-parsers = { path = "../../crates/reinhardt-rest/crates/parsers" }
reinhardt-exception = { path = "../../crates/reinhardt-core/crates/exception" }
reinhardt-types = { path = "../../crates/reinhardt-core/crates/types" }
reinhardt-signals = { path = "../../crates/reinhardt-core/crates/signals" }
reinhardt-websockets = { path = "../../crates/reinhardt-contrib/crates/websockets" }
reinhardt-http = { path = "../../crates/reinhardt-http" }
reinhardt-server = { path = "../../crates/reinhardt-server" }
reinhardt-logging = { path = "../../crates/reinhardt-utils/crates/logging" }
reinhardt-mail = { path = "../../crates/reinhardt-contrib/crates/mail" }
reinhardt-di = { path = "../../crates/reinhardt-di" }
reinhardt-macros = { path = "../../crates/reinhardt-core/crates/macros" }
reinhardt-static = { path = "../../crates/reinhardt-contrib/crates/static", features = [
  "templates-integration",
] }
reinhardt-cache = { path = "../../crates/reinhardt-utils/crates/cache" }
reinhardt-views-core = { path = "../../crates/reinhardt-views/crates/views-core" }
reinhardt-negotiation = { path = "../../crates/reinhardt-rest/crates/negotiation" }
reinhardt-renderers = { path = "../../crates/reinhardt-template/crates/renderers" }
reinhardt-validators = { path = "../../crates/reinhardt-core/crates/validators" }
reinhardt-serializers = { path = "../../crates/reinhardt-rest/crates/serializers" }
reinhardt-settings = { path = "../../crates/reinhardt-conf/crates/settings", features = [
  "dynamic-database",
  "dynamic-redis",
  "hot-reload",
  "caching",
] }
reinhardt-browsable-api = { path = "../../crates/reinhardt-rest/crates/browsable-api" }
reinhardt-i18n = { path = "../../crates/reinhardt-contrib/crates/i18n" }
reinhardt-tasks = { path = "../../crates/reinhardt-tasks" }
reinhardt-rest = { path = "../../crates/reinhardt-rest" }
reinhardt-pagination = { path = "../../crates/reinhardt-rest/crates/pagination" }
reinhardt-filters = { path = "../../crates/reinhardt-rest/crates/filters" }
reinhardt-forms = { path = "../../crates/reinhardt-forms" }
reinhardt-throttling = { path = "../../crates/reinhardt-rest/crates/throttling" }
reinhardt-utils = { path = "../../crates/reinhardt-utils" }
reinhardt-storage = { path = "../../crates/reinhardt-utils/crates/storage" }
reinhardt-test = { path = "../../crates/reinhardt-test" }
reinhardt-sessions = { path = "../../crates/reinhardt-contrib/crates/sessions", features = [
  "database",
] }

# Web framework (using reinhardt-apps)
tokio = { version = "1.0", features = ["full"] }
hyper = "1.0"
http = "1.0"
async-trait = "0.1"

# Database
sqlx = { version = "0.9.0-alpha.1", features = [
  "postgres",
  "sqlite",
  "runtime-tokio",
  "tls-rustls",
  "chrono",
] }

# HTTP client for testing
reqwest = { version = "0.12", features = ["cookies"] }

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
bytes = "1.0"

# GraphQL
async-graphql = "7.0.17"
futures-util = "0.3"

# Utilities
chrono = "0.4"
uuid = { version = "1.0", features = ["v4"] }
anyhow = "1.0"
base64 = "0.22"
percent-encoding = "2.3"
unic-langid = "0.9"
once_cell = "1.20"
serial_test = "3.2"
ctor = "0.6.0"

# Templates
askama = "0.14.0"

# Testing utilities
tempfile = "3.14"
testcontainers = "0.25.0"
image = { version = "0.25", default-features = false, features = ["png"] }

[features]
testcontainers = []

[dev-dependencies]
# Test utilities
tokio-test = "0.4"

[[test]]
name = "parser_integration"
path = "tests/api/parser_integration.rs"


[[test]]
name = "router_viewset_integration"
path = "tests/routing/router_viewset_integration.rs"


[[test]]
name = "csrf_middleware_integration"
path = "tests/middleware/csrf_middleware_integration.rs"


[[test]]
name = "auth_security_integration"
path = "tests/auth/auth_security_integration.rs"


[[test]]
name = "session_security_integration"
path = "tests/sessions/session_security_integration.rs"


# Temporarily disabled due to reinhardt-contrib View import error
# [[test]]
# name = "contrib_messages_integration_tests"
# path = "tests/contrib_messages_integration_tests.rs"

# [[test]]
# name = "contrib_health_integration_tests"
# path = "tests/contrib_health_integration_tests.rs"

[[test]]
name = "macros_di_integration_tests"
path = "tests/di/macros_di_integration_tests.rs"


[[test]]
name = "composite_pk_migration_tests"
path = "tests/migrations/composite_pk_migration_tests.rs"


[[test]]
name = "logging_orm_integration_tests"
path = "tests/utils/logging_orm_integration_tests.rs"


[[test]]
name = "renderers_http_integration_tests"
path = "tests/rendering/renderers_http_integration_tests.rs"


# Requires PostgreSQL database - testcontainers available but startup takes 3+ minutes
# Recommended manual setup for faster testing:
#   docker run --rm -d -p 5432:5432 -e POSTGRES_HOST_AUTH_METHOD=trust postgres:17-alpine
#   TEST_DATABASE_URL=postgres://postgres@localhost:5432/postgres cargo test -p reinhardt-integration-tests --test flatpages_integration_tests
# Uncomment to enable (warning: very slow first run due to Docker image download):
# [[test]]
# name = "flatpages_integration_tests"
# path = "../flatpages_integration_tests.rs"

[[test]]
name = "server_middleware_integration_tests"
path = "tests/server/server_middleware_integration_tests.rs"


[[test]]
name = "renderer_template_integration"
path = "tests/rendering/renderer_template_integration.rs"


[[test]]
name = "param_validation_integration"
path = "tests/validation/param_validation_integration.rs"


[[test]]
name = "query_encoding_integration"
path = "tests/utils/query_encoding_integration.rs"


[[test]]
name = "messages_framework_integration"
path = "tests/contrib/messages_framework_integration.rs"


[[test]]
name = "settings_system_integration"
path = "tests/settings/settings_system_integration.rs"


[[test]]
name = "browsable_api_integration"
path = "tests/api/browsable_api_integration.rs"


[[test]]
name = "parser_advanced_integration"
path = "tests/api/parser_advanced_integration.rs"


[[test]]
name = "server_advanced_integration"
path = "tests/server/server_advanced_integration.rs"


# Migrated from reinhardt-server (integration tests using multiple crates)
[[test]]
name = "viewset_router_tests"
path = "tests/routing/viewset_router_tests.rs"


[[test]]
name = "utils_comprehensive_integration"
path = "tests/utils/utils_comprehensive_integration.rs"


[[test]]
name = "storage_orm_integration_tests"
path = "tests/storage/storage_orm_integration_tests.rs"


[[test]]
name = "versioning_integration_tests"
path = "tests/api/versioning_integration_tests.rs"


# Template integration tests
[[test]]
name = "template_pagination_integration"
path = "tests/rendering/template_pagination_integration.rs"


[[test]]
name = "template_i18n_integration"
path = "tests/rendering/template_i18n_integration.rs"


[[test]]
name = "messages_integration"
path = "tests/contrib/messages_integration.rs"


# Pagination integration tests
[[test]]
name = "pagination_orm_integration"
path = "tests/pagination/orm.rs"


[[test]]
name = "serializer_integration_tests"
path = "tests/serializers/serializer_integration_tests.rs"


# Validator integration tests
[[test]]
name = "validator_orm_integration_tests"
path = "tests/validation/validator_orm_integration_tests.rs"


[[test]]
name = "orm_core_integration_tests"
path = "tests/database/orm_core_integration_tests.rs"


[[test]]
name = "di_core_integration_tests"
path = "tests/di/di_core_integration_tests.rs"


[[test]]
name = "renderers_core_integration_tests"
path = "tests/rendering/renderers_core_integration_tests.rs"


[[test]]
name = "graphql_integration"
path = "tests/contrib/graphql_integration.rs"


[[test]]
name = "websocket_integration_tests"
path = "tests/contrib/websocket_integration_tests.rs"


[[test]]
name = "metadata_tests"
path = "tests/api/metadata_tests.rs"


[[test]]
name = "throttling_integration_tests"
path = "tests/api/throttling_integration_tests.rs"


[[test]]
name = "pagination_basic_tests"
path = "tests/utils/pagination_basic_tests.rs"


[[test]]
name = "query_string_encoding_integration"
path = "tests/utils/query_string_encoding_integration.rs"


[[test]]
name = "views_core_integration_tests"
path = "tests/views/views_core_integration_tests.rs"


[[test]]
name = "server_tests"
path = "tests/server/server_tests.rs"


[[test]]
name = "server_test_helpers"
path = "tests/server/server_test_helpers.rs"


[[test]]
name = "dynamic_settings_memory"
path = "tests/settings/dynamic_settings_memory.rs"


[[test]]
name = "hot_reload_integration"
path = "tests/settings/hot_reload_integration.rs"


# Command integration tests
[[test]]
name = "commands_integration_tests"
path = "tests/commands/commands_integration_tests.rs"


# Macro integration tests
[[test]]
name = "macros_model_derive_integration"
path = "tests/macros/model_derive_integration.rs"


[[test]]
name = "macros_composite_pk_integration"
path = "tests/macros/composite_pk_integration.rs"


[[test]]
name = "macros_constraint_integration"
path = "tests/macros/constraint_integration.rs"


[[test]]
name = "macros_validator_integration"
path = "tests/macros/validator_integration.rs"


# Static template integration tests
[[test]]
name = "storage_static_template_integration_tests"
path = "tests/storage/static_template_integration_tests.rs"


[[test]]
name = "storage_static_processing_integration_tests"
path = "tests/storage/static_processing_integration_tests.rs"


[[test]]
name = "serializer_nested_integration_tests"
path = "tests/serializers/serializer_nested_integration_tests.rs"


# UnifiedRouter hierarchical routing integration tests
[[test]]
name = "unified_router_integration"
path = "tests/routing/unified_router_integration_tests.rs"


# Admin actions integration tests
[[test]]
name = "admin_actions_integration"
path = "tests/admin/admin_actions_integration.rs"


[[test]]
name = "admin_audit_integration"
path = "tests/admin/admin_audit_integration.rs"
