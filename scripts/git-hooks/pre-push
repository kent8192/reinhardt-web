#!/bin/sh
# Reinhardt pre-push hook
# Runs fmt and clippy checks before allowing push
# Skips checks when deleting remote branches

set -e

# Skip checks for branch deletion
if echo "$@" | grep -q -- "--delete"; then
    exit 0
fi

echo "ğŸ” Running pre-push checks..."

# Run cargo make fmt (check mode)
echo "ğŸ“ Checking code formatting..."
if ! cargo make fmt-check; then
    echo ""
    echo "âŒ Code formatting check failed!"
    echo "ğŸ’¡ Run \`cargo make fmt-fix-check\` to fix formatting issues"
    exit 1
fi

# Run cargo make clippy
echo "ğŸ”§ Running clippy linter..."
if ! cargo make clippy-check; then
    echo ""
    echo "âŒ Clippy check failed!"
    echo "ğŸ’¡ Fix the warnings above before pushing by \`cargo make clippy-fix\`"
    exit 1
fi

echo "âœ… All pre-push checks passed!"
exit 0
