# Docker Compose for Newman API Tests - examples-tutorial-rest
# Run: docker-compose -f docker-compose.api-tests.yml up --build
version: '3.8'

services:
  app:
    build:
      context: ../../..
      dockerfile: examples/local/examples-tutorial-rest/Dockerfile
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/snippets/"]
      interval: 5s
      timeout: 3s
      retries: 10
    networks:
      - api-test-network

  newman:
    image: postman/newman:alpine
    depends_on:
      app:
        condition: service_healthy
    volumes:
      - ./postman:/etc/newman:ro
      - ./postman/reports:/etc/newman/reports
    command: >
      run /etc/newman/collection.json
      --environment /etc/newman/environment.json
      --env-var "baseUrl=http://app:8000"
      --reporters cli,junit,html
      --reporter-junit-export /etc/newman/reports/junit.xml
      --reporter-html-export /etc/newman/reports/report.html
    networks:
      - api-test-network

networks:
  api-test-network:
    driver: bridge
