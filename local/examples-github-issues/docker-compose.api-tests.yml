# Docker Compose for Newman API Tests - examples-github-issues (GraphQL + JWT)
# Run: docker-compose -f docker-compose.api-tests.yml up --build
services:
  app:
    build:
      context: ../../..
      dockerfile: examples/local/examples-github-issues/Dockerfile
    healthcheck:
      test: [ "CMD", "curl", "-f", "-X", "POST", "-H", "Content-Type: application/json", "-d", "{\"query\":\"{ __typename }\"}", "http://localhost:8000/graphql" ]
      interval: 5s
      timeout: 3s
      retries: 10
    networks:
      - api-test-network

  newman:
    image: postman/newman:alpine
    depends_on:
      app:
        condition: service_healthy
    volumes:
      - ./postman:/etc/newman:ro
      - ./postman/reports:/etc/newman/reports
    command: >
      run /etc/newman/collection.json --environment /etc/newman/environment.json --env-var "baseUrl=http://app:8000" --reporters cli,junit,html --reporter-junit-export /etc/newman/reports/junit.xml --reporter-html-export /etc/newman/reports/report.html
    networks:
      - api-test-network

networks:
  api-test-network:
    driver: bridge
