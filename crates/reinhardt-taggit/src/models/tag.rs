//! Tag model definition
//!
//! Core tag entity with normalized name and URL-friendly slug.

use chrono::{DateTime, Utc};
use reinhardt_core::macros::model;
use serde::{Deserialize, Serialize};

/// Core tag entity
///
/// Represents a tag with a normalized name and auto-generated slug.
/// Tags are globally unique by name (case-insensitive if configured).
///
/// # Database Schema
///
/// ```sql
/// CREATE TABLE tags (
///     id BIGSERIAL PRIMARY KEY,
///     name VARCHAR(255) NOT NULL,
///     slug VARCHAR(255) NOT NULL,
///     created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
///     UNIQUE(name),
///     UNIQUE(slug)
/// );
/// ```
///
/// # Examples
///
/// ```rust,ignore
/// use reinhardt_taggit::Tag;
///
/// let tag = Tag {
///     id: None,
///     name: "rust-programming".to_string(),
///     slug: "rust-programming".to_string(),
///     created_at: Utc::now(),
/// };
/// ```
#[model(app_label = "taggit", table_name = "tags")]
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]
pub struct Tag {
	/// Primary key
	#[field(primary_key = true)]
	pub id: Option<i64>,

	/// Normalized tag name (unique, case-insensitive if configured)
	#[field(max_length = 255, unique = true)]
	pub name: String,

	/// URL-friendly slug (unique, auto-generated from name)
	#[field(max_length = 255, unique = true)]
	pub slug: String,

	/// Creation timestamp
	#[field(auto_now_add = true)]
	pub created_at: DateTime<Utc>,
}

// NOTE: `new` function is automatically generated by #[model] macro

#[cfg(test)]
mod tests {
	use super::*;

	#[test]
	fn test_tag_creation() {
		let tag = Tag::new("rust", "rust");
		assert_eq!(tag.name, "rust");
		assert_eq!(tag.slug, "rust");
		assert!(tag.id.is_none());
	}
}
