# reinhardt-mail

メール送信とテンプレート機能

## 概要

HTMLおよびプレーンテキスト、添付ファイル、インライン画像、テンプレートベースのメールをサポートするメールフレームワークです。SMTPおよび開発用コンソールバックエンドを含む複数のメールバックエンドをサポートします。

## 機能

### 実装済み ✓

#### コアメッセージ構築

- **EmailMessage**: ビルダーパターンを使用した柔軟なメールメッセージビルダー
  - 件名、本文、送信元アドレス、受信者リストの設定
  - プレーンテキストフォールバック付きのHTMLコンテンツサポート
  - メッセージを変更可能な変更メソッド
- **EmailMessageBuilder**: メールメッセージを構築するための型安全なビルダー

#### メールバックエンド

- **ConsoleBackend**: メールをコンソールに出力する開発用バックエンド
- **FileBackend**: メールをファイルに保存するバックエンド
- **MemoryBackend**: テスト用のインメモリストレージバックエンド
  - Arc<Mutex<>>を使用したスレッドセーフなメッセージ保存
  - メッセージのカウントと取得機能
- **SmtpBackend**: メール送信用のSMTPプロトコルバックエンド
- **EmailBackend trait**: カスタムバックエンドを実装するための拡張可能なトレイト

#### ユーティリティ関数

- **send_mail**: 基本的なメールを送信するためのシンプルな便利関数
- **send_mail_with_backend**: 特定のバックエンドを使用してメールを送信
- **send_mass_mail**: 効率的な複数メッセージ配信のための一括メール送信
- **mail_admins**: 件名プレフィックスサポート付きで管理者にメールを送信
- **mail_managers**: 件名プレフィックスサポート付きでマネージャーにメールを送信

#### 設定統合

- **backend_from_settings**: 設定からのバックエンド初期化
- メール設定のためのreinhardt-settingsとの統合
  - 管理者およびマネージャーのメールリスト
  - 件名プレフィックス設定
  - サーバーメールおよび送信元メール設定

#### エラー処理

- **EmailError**: メール操作のための包括的なエラータイプ
  - InvalidAddress: メールアドレス検証エラー
  - MissingField: 必須フィールド検証
  - BackendError: バックエンド固有のエラー
  - SmtpError: SMTPプロトコルエラー
  - IoError: ファイルシステムおよびI/Oエラー
  - TemplateError: テンプレートレンダリングエラー
  - AttachmentError: ファイル添付エラー
  - InvalidHeader: メールヘッダー検証エラー
  - HeaderInjection: ヘッダーインジェクション攻撃のセキュリティ検証

### 予定

- 動的メールコンテンツ用のテンプレートシステム統合
- ファイル添付サポート（AlternativeとAttachment構造体は定義されているが未実装）
- HTMLメール用のインライン画像サポート
- 高度なSMTP機能（TLS/SSL、認証方法）
- メールの検証とサニタイゼーション
- 非同期メール送信機能
- 一括メール操作のための接続プール
