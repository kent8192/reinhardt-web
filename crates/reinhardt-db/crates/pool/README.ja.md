# reinhardt-pool

コネクションプーリングユーティリティ

## 概要

データベースコネクションやその他のリソースのためのコネクションプール管理。

効率的なコネクション再利用、自動クリーンアップ、設定可能なプールサイジングを提供します。

## 機能

### 実装済み ✓

#### コアコネクションプール

- **マルチデータベースサポート**: PostgreSQL、MySQL、SQLiteコネクションプール
  - `ConnectionPool::new_postgres()` - PostgreSQLコネクションプールを作成
  - `ConnectionPool::new_mysql()` - MySQLコネクションプールを作成
  - `ConnectionPool::new_sqlite()` - SQLiteコネクションプールを作成
- **コネクション取得**: イベント発行付きプールからのコネクション取得
- **プールされたコネクション**: drop時に自動的にプールに戻るラッパータイプ
- **プール再作成**: すべてのデータベースタイプの同じ設定でプールを再作成
- **内部プールアクセス**: 必要に応じて基盤のsqlxプールへの直接アクセス

#### プール設定

- **柔軟なサイジング**: 設定可能な最小/最大コネクション制限
  - `max_connections` - 最大コネクション数
  - `min_connections` - 維持する最小アイドルコネクション数
  - `max_size` - 全体のプールサイズ制限
  - `min_idle` - オプションの最小アイドルコネクション数
- **タイムアウト管理**: 設定可能なコネクションと取得のタイムアウト
  - `connection_timeout` - 新しいコネクション作成のタイムアウト
  - `acquire_timeout` - プールからの取得のタイムアウト
  - `idle_timeout` - オプションのアイドルコネクションのタイムアウト
- **ライフサイクル設定**: コネクションライフタイムとアイドルタイムアウトの設定
  - `max_lifetime` - オプションの最大コネクションライフタイム
- **ヘルスチェック**: オプションの取得前テスト検証
  - `test_before_acquire` - 使用前のコネクション検証
- **ビルダーパターン**: メソッドチェーンによる人間工学的な設定のための`PoolOptions`

#### イベントシステム

- **コネクションライフサイクルイベント**: コネクション状態変更の追跡
  - `ConnectionAcquired` - プールからチェックアウトされたコネクション
  - `ConnectionReturned` - プールに返却されたコネクション
  - `ConnectionCreated` - 新しいコネクションが確立
  - `ConnectionClosed` - コネクションが終了
  - `ConnectionTestFailed` - ヘルスチェック失敗
  - `ConnectionInvalidated` - ハード無効化（コネクション使用不可）
  - `ConnectionSoftInvalidated` - ソフト無効化（現在の操作は完了可能）
  - `ConnectionReset` - コネクションリセット
- **イベントリスナー**: `PoolEventListener`トレイトを介したプールイベントのサブスクライブ
- **非同期イベントハンドリング**: ノンブロッキングイベント発行
- **組み込みロガー**: シンプルなイベントログのための`EventLogger`
- **タイムスタンプ付きイベント**: すべてのイベントにUTCタイムスタンプを含む
- **シリアライズ可能なイベント**: イベントはserdeシリアライゼーションをサポート

#### コネクション管理

- **コネクション無効化**:
  - `invalidate()`によるハード無効化 - コネクションは直ちに使用不可
  - `soft_invalidate()`によるソフト無効化 - 現在の操作は完了可能
- **コネクションリセット**: `reset()`によるコネクション状態のリセット
- **コネクションID追跡**: 各プールされたコネクションの一意のUUID
- **自動クリーンアップ**: イベント発行付きでdrop時に自動的にコネクションを返却

#### プール管理

- **マルチプール管理**: 複数の名前付きプールを管理するための`PoolManager`
  - `add_pool()` - 名前付きプールを登録
  - `get_pool()` - 型安全性付きで名前によりプールを取得
  - `remove_pool()` - プールの登録解除
- **型安全プールストレージ**: ダウンキャスト付きのジェネリックプールストレージ
- **共有設定**: 管理されたプール間での共通設定

#### 依存性注入サポート

- **データベースサービスラッパー**: DIフレームワークのための`DatabaseService`
- **データベースURLタイプ**: 型安全なURLのための`DatabaseUrl`ラッパー
- **プールタイププレースホルダー**: `MySqlPool`、`PostgresPool`、`SqlitePool`タイプ
- **マネージャータイプ**: 各データベースバックエンド専用のマネージャータイプ

#### エラーハンドリング

- **包括的なエラータイプ**: 詳細なエラーバリアント
  - `PoolClosed` - プールがクローズされた
  - `Timeout` - 操作タイムアウト
  - `PoolExhausted` - 最大コネクション数に到達
  - `InvalidConnection` - コネクション検証失敗
  - `Database` - sqlxデータベースエラー
  - `Config` - 設定検証エラー
  - `Connection` - コネクション固有のエラー
  - `PoolNotFound` - 名前付きプールが見つからない
- **型安全な結果**: `PoolResult<T>`型エイリアス
- **エラー伝播**: sqlxエラーからの自動変換

### 予定

現在、すべての予定機能は実装済みです。
