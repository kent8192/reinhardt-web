[package]
name = "reinhardt-pages"
version = "0.1.0-rc.1"
edition = "2024"
authors = ["Reinhardt Contributors"]
license = "BSD-3-Clause"
description = "WASM-based frontend framework for Reinhardt with Django-like API"
repository.workspace = true
keywords = ["wasm", "web", "frontend", "reactive", "django"]
categories = ["wasm", "web-programming"]

[features]
default = []
msgpack = ["dep:rmp-serde"]
pages-full = ["msgpack", "web-sys-full"]
static = []
urls = []
debug-hooks = []
uuid = ["dep:uuid"]
chrono = ["dep:chrono"]
ast = []
# web-sys features for WASM applications
# Applications should use this feature to get all required web-sys features
web-sys-full = [
	"web-sys/Window",
	"web-sys/Document",
	"web-sys/Element",
	"web-sys/HtmlElement",
	"web-sys/Node",
	"web-sys/Comment",
	"web-sys/Text",
	"web-sys/Event",
	"web-sys/EventTarget",
	"web-sys/console",
	"web-sys/MouseEvent",
	"web-sys/InputEvent",
	"web-sys/KeyboardEvent",
	"web-sys/FocusEvent",
	"web-sys/PopStateEvent",
	"web-sys/HtmlInputElement",
	"web-sys/HtmlButtonElement",
	"web-sys/HtmlDivElement",
	"web-sys/HtmlSpanElement",
	"web-sys/HtmlFormElement",
	"web-sys/HtmlTextAreaElement",
	"web-sys/HtmlSelectElement",
	"web-sys/DomTokenList",
	"web-sys/NamedNodeMap",
	"web-sys/Attr",
	"web-sys/HtmlCollection",
	"web-sys/NodeList",
	"web-sys/HtmlDocument",
	"web-sys/History",
	"web-sys/Location",
	"web-sys/WebSocket",
	"web-sys/MessageEvent",
	"web-sys/CloseEvent",
	"web-sys/ErrorEvent",
	"web-sys/BinaryType",
]

[dependencies]
# Documentation
aquamarine = "0.5"

# Constant-time comparison for CSRF token verification
subtle = { workspace = true }

# Core types (Page, PageElement, Head, etc.)

# Reactive system

# AST definitions
reinhardt-pages-ast = { workspace = true }

# Procedural macros
reinhardt-pages-macros = { workspace = true }

# Core WASM bindings (low-level APIs only)
wasm-bindgen = "0.2.106"
js-sys = "0.3.83"

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_urlencoded = "0.7"
rmp-serde = { version = "1.3", optional = true }
urlencoding = "2.1"

# Router pattern matching
regex = "1.11"

# Optional type support for path parameters
uuid = { version = "1.0", optional = true, features = ["std"] }
chrono = { version = "0.4", optional = true, default-features = false, features = ["std"] }

# Web APIs
web-sys = { version = "0.3.83", features = [
	"Window",
	"Document",
	"Element",
	"HtmlElement",
	"Node",
	"Comment",
	"Text",
	"Event",
	"EventTarget",
	"console",
	# Event types
	"MouseEvent",
	"InputEvent",
	"KeyboardEvent",
	"FocusEvent",
	"PopStateEvent",
	# HTML element types
	"HtmlInputElement",
	"HtmlButtonElement",
	"HtmlDivElement",
	"HtmlSpanElement",
	"HtmlFormElement",
	"HtmlTextAreaElement",
	"HtmlSelectElement",
	# DOM manipulation
	"DomTokenList",
	"NamedNodeMap",
	"Attr",
	"HtmlCollection",
	"NodeList",
	"HtmlDocument",
	# History API (for router)
	"History",
	"Location",
	# WebSocket API
	"WebSocket",
	"MessageEvent",
	"CloseEvent",
	"ErrorEvent",
	"BinaryType",
] }

# Async support for WASM
reinhardt-core = {workspace = true, features = ["reactive", "page"]}
syn = { version = "2.0", features = ["full", "extra-traits", "parsing"] }
quote = "1.0"
proc-macro2 = "1.0"
[target.'cfg(target_arch = "wasm32")'.dependencies]
wasm-bindgen-futures = "0.4.56"
gloo-net = "0.6"
getrandom = { version = "0.3", features = ["wasm_js"] }
uuid = { version = "1.0", features = ["js"] }

# Server-side only dependencies (DI, HTTP, Forms, Server Function Registry)
[target.'cfg(not(target_arch = "wasm32"))'.dependencies]
reinhardt-forms = { workspace = true }
reinhardt-di = { workspace = true }
reinhardt-http = { workspace = true }
reinhardt-middleware = { workspace = true }
reinhardt-urls = { workspace = true, features = ["routers"] }
reinhardt-server = { workspace = true }
reinhardt-utils = { workspace = true, features = ["staticfiles"] }
hyper = { workspace = true }
async-trait = "0.1"
uuid = { version = "1.0", features = ["v4"] }
tokio = { workspace = true }

[build-dependencies]
cfg_aliases = "0.2"

[dev-dependencies]
reinhardt-forms = { workspace = true }
wasm-bindgen-test = "0.3.56"
serial_test = "3"
trybuild = "1.0"
criterion = "0.5"
rstest = { workspace = true }
proptest = { workspace = true }
tempfile = { workspace = true }

[lib]
crate-type = ["rlib"]

[[bench]]
name = "wasm_framework_benchmarks"
harness = false

[[test]]
name = "csrf_wasm_test"
path = "tests/wasm/csrf_wasm_test.rs"
required-features = []

[[test]]
name = "server_fn_wasm_test"
path = "tests/wasm/server_fn_wasm_test.rs"
required-features = []
