[package]
name = "reinhardt-websockets"
version = "0.1.0-rc.1"
description = "WebSocket support for real-time bidirectional communication"
edition.workspace = true
license.workspace = true
repository.workspace = true
authors.workspace = true

[dependencies]
# Async runtime
tokio = { workspace = true }
tokio-tungstenite = "0.28.0"
async-trait = { workspace = true }

# WebSocket
tungstenite = "0.28.0"
futures-util = "0.3"

# Serialization
serde = { workspace = true }
serde_json = { workspace = true }

# Error handling
thiserror = { workspace = true }
anyhow = { workspace = true }

# Utilities
bytes = { workspace = true }
once_cell = "1.19"
chrono = { version = "0.4", features = ["serde"] }

# Dependency injection (optional)
reinhardt-di = { workspace = true, optional = true }

# Pages integration (optional)
reinhardt-pages = { workspace = true, optional = true }

# Auth integration (optional, for pages-integration)
reinhardt-auth = { workspace = true, optional = true, features = ["sessions"] }

# Compression
flate2 = { version = "1.0", optional = true }
brotli = { version = "8.0.2", optional = true }

# Redis channel layer
redis = { version = "0.32.7", features = [
    "tokio-comp",
    "connection-manager",
], optional = true }

# Metrics
metrics = { version = "0.24", optional = true }

# Logging
tracing = { workspace = true }

[dev-dependencies]
insta = { workspace = true }
tokio-test = "0.4"
futures = { workspace = true }
rstest = { workspace = true }
rand = { workspace = true }

[features]
default = []
di = ["reinhardt-di"]
compression = ["flate2", "brotli"]
redis-channel = ["redis"]
metrics = ["dep:metrics"]
pages-integration = ["reinhardt-pages", "reinhardt-auth"]
full = ["compression", "redis-channel", "metrics", "di", "pages-integration"]
