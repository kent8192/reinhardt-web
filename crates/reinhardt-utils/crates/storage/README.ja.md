# reinhardt-storage

ファイルストレージバックエンド

## 概要

ローカルファイルシステム、クラウドストレージ(S3、Azure、GCS)、カスタムストレージバックエンドをサポートするファイルストレージの抽象化レイヤーです。ファイルのアップロード、ダウンロード、URL生成を処理します。

## 機能

### 実装済み ✓

#### コアストレージ抽象化

- **Storageトレイト**: 標準的なストレージ操作を定義する非同期トレイト
  - ファイルの保存、読み取り、削除操作
  - ファイルの存在確認とメタデータ取得
  - ディレクトリリスト機能
  - ファイルアクセス用のURL生成
  - ファイルタイムスタンプ操作(アクセス時刻、作成時刻、変更時刻)

#### ファイルとメタデータの処理

- **FileMetadata**: 包括的なファイルメタデータ構造
  - パス、サイズ、コンテンツタイプの追跡
  - 作成および変更タイムスタンプ
  - オプションのチェックサムサポート(SHA-256)
  - ビルダーパターンメソッド(`with_content_type`、`with_checksum`)
- **StoredFile**: メタデータとコンテンツを含むファイル表現

#### エラー処理

- **StorageError**: 包括的なエラータイプ
  - ファイルが見つからないエラー
  - I/Oエラーの伝播
  - 無効なパスの検出
  - ストレージ満杯状態
  - パーミッション拒否エラー
  - ファイルが既に存在するエラー

#### ローカルファイルシステムストレージ

- **LocalStorage**: 本番環境対応のローカルファイルシステムバックエンド
  - 自動ディレクトリ作成
  - パストラバーサル攻撃の防止
  - SHA-256チェックサム計算
  - ファイルタイムスタンプ取得(アクセス時刻、作成時刻、変更時刻)
  - 設定可能なベースURLを使用したURL生成
  - 包括的なディレクトリリスト

#### インメモリストレージ

- **InMemoryStorage**: テストと開発用のストレージバックエンド
  - Arc<RwLock>を使用したスレッドセーフなインメモリファイルストレージ
  - タイムスタンプ追跡(アクセス時刻、作成時刻、変更時刻)
  - ディレクトリスタイルのパス構成
  - 設定可能なファイルとディレクトリのパーミッションモード
  - シリアライゼーション用のDjangoスタイルの分解
  - 簡単なテストのためのクローンサポート

#### Preludeモジュール

- 便利なインポートのための一般的に使用される型の再エクスポート

### 予定

現在、すべての予定された機能が実装されています。
