[package]
name = "reinhardt"
version.workspace = true
edition.workspace = true
license.workspace = true
description = "A full-stack API framework for Rust, inspired by Django and Django REST Framework"
repository.workspace = true
authors.workspace = true

[features]
default = ["standard"]

# Minimal feature set - for microservices and simple APIs
minimal = ["reinhardt-core/di", "reinhardt-core/params"]

# Standard feature set - balanced for most projects
standard = [
  "minimal",
  "reinhardt-db",
  "reinhardt-db/orm",
  "reinhardt-rest",
  "reinhardt-rest/serializers",
  "reinhardt-views/viewsets",
  "reinhardt-contrib",
  "reinhardt-contrib/auth",
  "reinhardt-middleware",
  "reinhardt-rest/pagination",
  "reinhardt-rest/filters",
  "reinhardt-rest/throttling",
  "reinhardt-core",
  "reinhardt-core/signals",
  "reinhardt-rest/parsers",
  "reinhardt-template",
  "reinhardt-template/renderers",
  "reinhardt-rest/versioning",
  "reinhardt-rest/metadata",
  "reinhardt-rest/negotiation",
]

# Individual feature flags for fine-grained control
database = [
  "reinhardt-db",
  "reinhardt-db/orm",
  "reinhardt-db/migrations",
  "reinhardt-contrib",
  "reinhardt-contrib/contenttypes",
]
api = ["reinhardt-rest", "reinhardt-rest/serializers", "reinhardt-views/viewsets"]
auth = ["reinhardt-contrib", "reinhardt-contrib/auth"]
# admin = ["reinhardt-admin", "reinhardt-forms", "reinhardt-template"]  # reinhardt-admin not yet created
admin = ["reinhardt-forms", "reinhardt-template"]
forms = ["reinhardt-forms"]
graphql = ["reinhardt-contrib", "reinhardt-contrib/graphql"]
templates = ["reinhardt-template"]
websockets = ["reinhardt-contrib", "reinhardt-contrib/websockets"]
cache = ["reinhardt-utils/cache"]
redis-backend = ["cache"]
i18n = ["reinhardt-contrib", "reinhardt-contrib/i18n"]
mail = ["reinhardt-contrib", "reinhardt-contrib/mail"]
sessions = ["reinhardt-contrib", "reinhardt-contrib/sessions"]
middleware = ["sessions", "reinhardt-contrib/sessions"]
static-files = ["reinhardt-contrib", "reinhardt-contrib/static"]
storage = ["reinhardt-utils/storage"]
contrib = ["reinhardt-contrib"]
shortcuts = ["reinhardt-shortcuts"]
tasks = ["reinhardt-tasks"]
server = ["reinhardt-server"]

# Parent crate features (new module structure)
conf = ["reinhardt-conf"]
core = ["reinhardt-core"]
rest = ["reinhardt-rest"]
di = ["reinhardt-core/di"]
di-generator = ["di", "reinhardt-core/di-generator"]
test = ["reinhardt-test"]

# Meta features
full = [
  "standard",
  "database",
  "auth",
  "admin",
  "graphql",
  "websockets",
  "cache",
  "i18n",
  "mail",
  "sessions",
  "static-files",
  "storage",
  "contrib",
]

# API-only preset - REST without templates/forms
api-only = [
  "minimal",
  "reinhardt-rest",
  "reinhardt-rest/serializers",
  "reinhardt-views/viewsets",
  "reinhardt-contrib",
  "reinhardt-contrib/auth",
  "reinhardt-rest/parsers",
  "reinhardt-template",
  "reinhardt-template/renderers",
  "reinhardt-rest/versioning",
  "reinhardt-rest/metadata",
  "reinhardt-rest/negotiation",
  "reinhardt-rest/pagination",
  "reinhardt-rest/filters",
  "reinhardt-rest/throttling",
]

# GraphQL-focused preset
graphql-server = [
  "minimal",
  "reinhardt-contrib",
  "reinhardt-contrib/graphql",
  "reinhardt-contrib/auth",
  "database",
]

# WebSocket-centric preset
websocket-server = [
  "minimal",
  "reinhardt-contrib",
  "reinhardt-contrib/websockets",
  "reinhardt-contrib/auth",
  "reinhardt-utils/cache",
]

# CLI/Background jobs preset
cli-tools = [
  "database",
  "reinhardt-db",
  "reinhardt-db/migrations",
  "reinhardt-tasks",
  "reinhardt-contrib",
  "reinhardt-contrib/mail",
]

# Testing utilities preset
test-utils = [
  "reinhardt-test",
  "database",
]

# Fine-grained authentication
auth-jwt = ["auth", "reinhardt-contrib/auth-jwt"]
auth-session = ["auth", "reinhardt-contrib/auth-session", "sessions"]
auth-oauth = ["auth", "reinhardt-contrib/auth-oauth"]
auth-token = ["auth", "reinhardt-contrib/auth-token"]

# Fine-grained database support
db-postgres = ["database", "reinhardt-db/postgres"]
db-mysql = ["database", "reinhardt-db/mysql"]
db-sqlite = ["database", "reinhardt-db/sqlite"]
db-mongodb = ["database", "reinhardt-db/mongodb-backend"]
db-cockroachdb = ["database", "reinhardt-db/cockroachdb-backend"]

# Fine-grained serialization
serialize-json = ["reinhardt-rest", "reinhardt-rest/serializers"]
serialize-xml = ["reinhardt-rest", "reinhardt-rest/serializers"]
serialize-yaml = ["reinhardt-rest", "reinhardt-rest/serializers"]

# Fine-grained middleware
middleware-cors = ["reinhardt-middleware", "reinhardt-middleware/cors"]
middleware-compression = ["reinhardt-middleware", "reinhardt-middleware/compression"]
middleware-security = ["reinhardt-middleware", "reinhardt-middleware/security"]
middleware-rate-limit = ["reinhardt-middleware", "reinhardt-middleware/rate-limit"]

[dependencies]
# Core dependencies (always included)
reinhardt-urls = { workspace = true }
reinhardt-utils = { workspace = true }
reinhardt-views = { workspace = true }
bytes = { workspace = true }
hyper = { workspace = true }

# Parent crate dependencies (new module structure)
# These parent crates expose their subcrates via features
reinhardt-conf = { workspace = true, optional = true }
reinhardt-core = { workspace = true, optional = true }
reinhardt-db = { workspace = true, optional = true }
reinhardt-template = { workspace = true, optional = true }
reinhardt-test = { workspace = true, optional = true }
reinhardt-rest = { workspace = true, optional = true }
reinhardt-contrib = { workspace = true, optional = true }

# Additional optional dependencies
# reinhardt-admin = { workspace = true, optional = true }  # Not yet created
reinhardt-forms = { workspace = true, optional = true }
reinhardt-middleware = { workspace = true, optional = true }
reinhardt-shortcuts = { workspace = true, optional = true }
reinhardt-tasks = { workspace = true, optional = true }
reinhardt-server = { workspace = true, optional = true }

# Re-export commonly used dependencies
tokio = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
async-trait = { workspace = true }
thiserror = { workspace = true }
toml = "0.9.8"

[workspace]
resolver = "3"
members = [
  # Core framework (always included)
  "crates/reinhardt-micro",
  "crates/reinhardt-conf",
  "crates/reinhardt-core",
  "crates/reinhardt-server",
  "crates/reinhardt-views",
  "crates/reinhardt-urls",
  "crates/reinhardt-middleware",
  "crates/reinhardt-test",
  "crates/reinhardt-tasks",
  "crates/reinhardt-utils",
  "crates/reinhardt-rest",
  "crates/reinhardt-contrib",
  "crates/reinhardt-grpc",
  "crates/reinhardt-graphql-macros",
  "crates/reinhardt-commands",
  "crates/reinhardt-admin", # CLI tool
  "crates/reinhardt-db",
  "crates/reinhardt-dispatch",
  "crates/reinhardt-shortcuts",
  "crates/reinhardt-forms",
  "crates/reinhardt-template",
  # Integration tests
  "tests",
]

exclude = []

default-members = [
  "crates/reinhardt-views",
  "crates/reinhardt-middleware",
  "crates/reinhardt-test",
  "crates/reinhardt-tasks",
  "crates/reinhardt-utils",
  "crates/reinhardt-rest",
  "crates/reinhardt-contrib",
]

[workspace.package]
version = "0.1.0-alpha.1"
edition = "2024"
license = "MIT OR Apache-2.0"
repository = "https://github.com/kent8192/reinhardt-rs"
authors = ["kent8192 <51869472+kent8192@users.noreply.github.com>"]

[workspace.metadata.workspaces]
# cargo-workspaces configuration
allow-branch = "main"           # Only allow publishing from main branch
allow-dirty = false             # Require clean working directory
no-individual-tags = true       # Disable cargo-ws automatic tag generation (we use GitHub Actions)

[workspace.dependencies]
# Internal crates
reinhardt-micro = { path = "crates/reinhardt-micro", version = "0.1.0-alpha.1" }
reinhardt-conf = { path = "crates/reinhardt-conf", version = "0.1.0-alpha.1" }
reinhardt-core = { path = "crates/reinhardt-core", version = "0.1.0-alpha.1" }
reinhardt-server = { path = "crates/reinhardt-server", version = "0.1.0-alpha.1" }
reinhardt-views = { path = "crates/reinhardt-views", version = "0.1.0-alpha.1" }
reinhardt-urls = { path = "crates/reinhardt-urls", version = "0.1.0-alpha.1" }
reinhardt-middleware = { path = "crates/reinhardt-middleware", version = "0.1.0-alpha.1" }
reinhardt-template = { path = "crates/reinhardt-template", version = "0.1.0-alpha.1" }
reinhardt-forms = { path = "crates/reinhardt-forms", version = "0.1.0-alpha.1" }
reinhardt-test = { path = "crates/reinhardt-test", version = "0.1.0-alpha.1" }
reinhardt-tasks = { path = "crates/reinhardt-tasks", version = "0.1.0-alpha.1" }
reinhardt-utils = { path = "crates/reinhardt-utils", version = "0.1.0-alpha.1" }
reinhardt-rest = { path = "crates/reinhardt-rest", version = "0.1.0-alpha.1" }
reinhardt-contrib = { path = "crates/reinhardt-contrib", version = "0.1.0-alpha.1" }
reinhardt-grpc = { path = "crates/reinhardt-grpc", version = "0.1.0-alpha.1" }
reinhardt-graphql-macros = { path = "crates/reinhardt-graphql-macros", version = "0.1.0-alpha.1" }
reinhardt-commands = { path = "crates/reinhardt-commands", version = "0.1.0-alpha.1" }
reinhardt-admin-cli = { path = "crates/reinhardt-admin", version = "0.1.0-alpha.1" }
reinhardt-db = { path = "crates/reinhardt-db", version = "0.1.0-alpha.1" }
reinhardt-postgres = { path = "crates/reinhardt-postgres", version = "0.1.0-alpha.1" }
reinhardt-events = { path = "crates/reinhardt-events", version = "0.1.0-alpha.1" }
reinhardt-shortcuts = { path = "crates/reinhardt-shortcuts", version = "0.1.0-alpha.1" }
reinhardt-dispatch = { path = "crates/reinhardt-dispatch", version = "0.1.0-alpha.1" }

# Web framework
tokio = { version = "1.48.0", features = ["full"] }
tokio-stream = "0.1.17"
futures = "0.3.31"
hyper = { version = "1.7.0", features = ["full"] }
hyper-util = { version = "0.1.17", features = ["full"] }
http = "1.3.1"
http-body-util = "0.1.3"

# Serialization
serde = { version = "1.0.228", features = ["derive"] }
serde_json = "1.0.145"
serde_yaml = "0.9"
serde_urlencoded = "0.7.1"

# Database
sqlx = { version = "0.8", features = [
  "runtime-tokio",
  "tls-rustls",
  "sqlite",
  "postgres",
  "mysql",
  "any",
  "macros",
  "migrate",
] }

# Authentication & Security
argon2 = { version = "0.6.0-rc.1", features = ["std"] }
rand = "0.10.0-rc.0"
rand_core = "0.9"
jsonwebtoken = { version = "10.1.0", features = ["aws_lc_rs"] }
uuid = { version = "1.18.1", features = ["v4", "serde"] }

# Async traits
async-trait = "0.1.89"

# Error handling
thiserror = "2.0.17"
anyhow = "1.0.100"

# Routing
regex = "1.12.2"
nom = "8.0.0"

# Utilities
chrono = { version = "0.4.42", features = ["serde"] }
chrono-tz = "0.10.4"
bytes = "1.10.1"
once_cell = "1.21.3"
tracing = "0.1.41"
parking_lot = "0.12"
base64 = "0.22"

# Template engine & syntax highlighting
tera = { version = "1.20" }
syntect = "5.2"

# Cryptography & Security
aes-gcm = "0.11.0-rc.1"
sha2 = "0.10.9"
hmac = "0.12"

# Image Processing
image = "0.25.8"

# Compression
flate2 = "1.1.5"
brotli = "8.0.2"

# Phone Number Validation
phonenumber = "0.3.7"

# Serialization formats
rmp-serde = "1.3.0"
prost = "0.14.1"

# Redis (for sessions)
# Temporarily downgraded to 0.32 due to deadpool-redis compatibility
# TODO: Upgrade to redis 1.0 when deadpool-redis supports it
redis = { version = "0.32", features = [
  "tokio-comp",
  "connection-manager",
] }

# Connection pooling & migrations
refinery = { version = "0.9.0", features = ["tokio-postgres"] }
sea-query = { version = "1.0.0-rc.1", features = ["with-json", "with-chrono", "postgres-array"] }
sea-orm = { version = "1.1.3", features = ["sqlx-postgres", "runtime-tokio-rustls"] }

# Testing
testcontainers = { version = "0.25.2", features = ["blocking"] }
testcontainers-modules = { version = "0.13.0", features = [
  "postgres",
  "mysql",
  "redis",
] }
proptest = "1.8.0"
tokio-test = "0.4.4"
serial_test = "3.2.0"
rstest = "0.26.1"
scopeguard = "1.2.0"
